# خطة اختبار بيئة Staging

## 1. تجهيز البيئة
- أنشئ نسخة طبق الأصل من المتغيرات السرية وملف `requirements.txt`.
- اربط قاعدة بيانات منفصلة (يفضل نسخة احتياطية حديثة للحجم الكامل، أو نسخة مصغرة مجهولة).
- فعّل storage منفصل لمجلد `data/uploads` لتجنّب الكتابة على ملفات الإنتاج.

## 2. خطوات الترحيل
1. خذ نسخة احتياطية كاملة من قاعدة بيانات الإنتاج والملفات.
2. استورد النسخة الاحتياطية في قاعدة بيانات staging.
3. نفّذ سكربت تهيئة المجلدات (`init_db()` أو `flask init-db`) للتأكد من إنشاء الجداول/المجلدات.

## 3. سيناريوهات الاختبار الأساسية
- **الأداء**: افحص `/ops/metrics` وتأكد من تسجيل القراءات عند تصفح الواجهات الرئيسية.
- **التخزين المؤقت**: ارفع ملفاً واختبر رؤيته من خلال `/data/uploads/...` مع التحقق من رؤوس `Cache-Control`.
- **المراسلة**: أرسل رسالة كمدير واطلب صفحة `/my_messages` لطلّاب عشوائيين للتحقق من تحديث العدّادات ومنع الاستعلامات المتكررة.
- **رفع الفيديو**: ارفع فيديو منهجي/إثرائي وتأكد من ظهور التحديث في لوحة المراجعة ومن تحديث عدد الفيديوهات غير المعتمدة.
- **التقارير**: شغّل اختباراً يدويًا لـ `/admin/send_champions_telegram` مع إعدادات وهمية وتحقق من السجلات.

## 4. مراقبة ما بعد النشر
- راقب سجلات `app.logger` لأي تحذيرات “Slow request”.
- قارن نتائج Lighthouse قبل/بعد التحسينات واحفظ التقرير في سجل داخلي.
- في حال ظهور أخطاء، استخدم النسخة الاحتياطية للرجوع الفوري ثم حل المشكلة في staging قبل إعادة المحاولة.

